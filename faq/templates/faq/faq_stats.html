{% extends 'base.html' %}
{% block content %}
<!-- âœ… í†µê³„ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ì‹œì‘ -->
<div style="max-width: 880px; margin: 0 auto; padding: 20px;">
  <h2 style="color: #4b0082; margin-bottom: 16px;">ğŸ“Š FAQ í†µê³„ ëŒ€ì‹œë³´ë“œ</h2>

  <!-- âœ… Chart.jsìš© ë°ì´í„° ì „ë‹¬ div (JSì—ì„œ ì½ì–´ì˜´) -->
  <div id="faqStatsData"
       data-category='{{ category_counts|safe }}'
       data-area='{{ area_counts|safe }}'></div>

  <!-- âœ… ê·¸ë˜í”„ ìœ í˜• ì „í™˜ ë²„íŠ¼ -->
  <div style="margin: 16px 0; display: flex; flex-wrap: wrap; gap: 8px;">
    <a href="#" class="btn-light" onclick="switchChart('bar'); return false;">ğŸ“Š ë§‰ëŒ€ ê·¸ë˜í”„</a>
    <a href="#" class="btn-light" onclick="switchChart('doughnut'); return false;">ğŸ© ë„ë„› ê·¸ë˜í”„</a>
  </div>

  <!-- âœ… ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ ê·¸ë˜í”„ -->
  <div style="background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 24px; margin-bottom: 32px; overflow-x: auto;">
    <h3 style="color: #4b0082; margin-bottom: 16px;">ğŸ“ ì¹´í…Œê³ ë¦¬ë³„ FAQ</h3>
    <canvas id="categoryChart" height="300"></canvas>
  </div>

  <!-- âœ… êµ¬ì—­ë³„ í†µê³„ ê·¸ë˜í”„ -->
  <div style="background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 24px; overflow-x: auto;">
    <h3 style="color: #4b0082; margin-bottom: 16px;">ğŸ§­ êµ¬ì—­ë³„ FAQ</h3>
    <canvas id="areaChart" height="300"></canvas>
  </div>
</div>

<!-- âœ… Chart.js ë° ë¼ë²¨ í”ŒëŸ¬ê·¸ì¸ ë¡œë“œ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<script>
  const dataElement = document.getElementById('faqStatsData');
  const categoryData = JSON.parse(dataElement.dataset.category);
  const areaData = JSON.parse(dataElement.dataset.area);

  const categoryLabels = Object.keys(categoryData);
  const categoryValues = Object.values(categoryData);
  const areaLabels = Object.keys(areaData);
  const areaValues = Object.values(areaData);

  const categoryColorMap = {
    'ë¶„ë¥˜': '#8A2BE2',
    'ê°€ë ¤ì§': '#FF6384',
    'ìŠ¤í”Œë¼ì¸': '#36A2EB',
    'ê¸°íƒ€': '#FFCE56'
  };
  const areaColorMap = {
    'LD': '#4BC0C0',
    'RBD': '#9966FF',
    'Lane': '#FF9F40',
    'Tool': '#00C49F'
  };

  const categoryColors = categoryLabels.map(label => categoryColorMap[label] || '#999999');
  const areaColors = areaLabels.map(label => areaColorMap[label] || '#CCCCCC');

  function createChart(ctx, type, labels, data, backgroundColors) {
    return new Chart(ctx, {
      type: type,
      data: {
        labels: labels,
        datasets: [{
          label: 'ê±´ìˆ˜',
          data: data,
          backgroundColor: backgroundColors,
          borderColor: '#fff',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom' },
          tooltip: { enabled: true },
          datalabels: {
            color: '#333',
            anchor: 'end',
            align: 'top',
            font: { weight: 'bold' },
            formatter: (value) => value
          }
        }
      },
      plugins: [ChartDataLabels]
    });
  }

  let currentType = 'bar';
  const categoryCtx = document.getElementById('categoryChart').getContext('2d');
  const areaCtx = document.getElementById('areaChart').getContext('2d');

  let categoryChart = createChart(categoryCtx, currentType, categoryLabels, categoryValues, categoryColors);
  let areaChart = createChart(areaCtx, currentType, areaLabels, areaValues, areaColors);

  function switchChart(newType) {
    if (newType !== currentType) {
      categoryChart.destroy();
      areaChart.destroy();
      categoryChart = createChart(categoryCtx, newType, categoryLabels, categoryValues, categoryColors);
      areaChart = createChart(areaCtx, newType, areaLabels, areaValues, areaColors);
      currentType = newType;
    }
  }
</script>
{% endblock %}
